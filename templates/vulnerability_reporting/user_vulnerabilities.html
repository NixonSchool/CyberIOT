{% extends 'vulnerability_reporting/base2.html' %}
{% load static %}

{% block title %}My Reported Vulnerabilities - CyberIoT{% endblock %}

{% block header_title %}My Reported Vulnerabilities{% endblock %}

{% block extra_css %}
<style>
    .vulnerability-list {
        margin-top: 2rem;
    }
    .vulnerability-item {
        background-color: white;
        border-radius: 8px;
        box-shadow: var(--box-shadow);
        padding: 1rem;
        margin-bottom: 1rem;
        transition: transform 0.3s ease;
    }
    .vulnerability-item:hover {
        transform: translateY(-5px);
    }
    .vulnerability-item h3 {
        margin-top: 0;
        color: var(--primary-color);
    }
    .vulnerability-item p {
        margin-bottom: 0.5rem;
    }
    .vulnerability-meta {
        font-size: 0.9rem;
        color: #6c757d;
        display: flex;
        justify-content: space-between;
        flex-wrap: wrap;
    }
    .vulnerability-status {
        font-weight: bold;
    }
    .status-pending { color: #ffc107; }
    .status-under-review { color: #17a2b8; }
    .status-verified { color: #28a745; }
    .status-resolved { color: #20c997; }
    .status-rejected { color: #dc3545; }
    .vulnerability-actions {
        margin-top: 1rem;
    }
    .vulnerability-actions a {
        margin-right: 0.5rem;
    }
    .pagination {
        margin-top: 2rem;
    }
    .pagination .page-item .page-link {
        color: var(--primary-color);
        border-color: var(--primary-color);
    }
    .pagination .page-item.active .page-link {
        background-color: var(--primary-color);
        border-color: var(--primary-color);
    }
    .no-vulnerabilities {
        text-align: center;
        margin-top: 2rem;
        padding: 2rem;
        background-color: white;
        border-radius: 8px;
        box-shadow: var(--box-shadow);
    }
</style>
{% endblock %}

{% block content %}
<div class="vulnerability-list">
    {% if page_obj %}
        <p>You have reported {{ page_obj.paginator.count }} vulnerability{% if page_obj.paginator.count != 1 %}ies{% endif %}.</p>
        {% for vulnerability in page_obj %}
            <div class="vulnerability-item">
                <h3><a href="{% url 'exploits:vulnerability_detail' slug=vulnerability.slug %}">{{ vulnerability.title }}</a></h3>
                <p>{{ vulnerability.description|truncatewords:30 }}</p>
                <div class="vulnerability-meta">
                    <span><i class="fas fa-calendar-alt"></i> Reported: {{ vulnerability.reported_at|date:"M d, Y" }}</span>
                    <span><i class="fas fa-exclamation-triangle"></i> Severity: {{ vulnerability.get_severity_display }}</span>
                    <span class="vulnerability-status status-{{ vulnerability.status|slugify }}">
                        <i class="fas fa-info-circle"></i> Status: {{ vulnerability.get_status_display }}
                    </span>
                </div>
                <div class="vulnerability-actions">
                    <a href="{% url 'exploits:vulnerability_detail' slug=vulnerability.slug %}" class="btn btn-sm btn-primary">View Details</a>
                    {% if vulnerability.status == 'pending' %}
                        <a href="{% url 'exploits:edit_vulnerability' slug=vulnerability.slug %}" class="btn btn-sm btn-secondary">Edit</a>
                    {% endif %}
                </div>
            </div>
        {% endfor %}

        {% if page_obj.has_other_pages %}
            <nav aria-label="Vulnerability pages">
                <ul class="pagination justify-content-center">
                    {% if page_obj.has_previous %}
                        <li class="page-item"><a class="page-link" href="?page={{ page_obj.previous_page_number }}">&laquo; Previous</a></li>
                    {% else %}
                        <li class="page-item disabled"><span class="page-link">&laquo; Previous</span></li>
                    {% endif %}

                    {% for i in page_obj.paginator.page_range %}
                        {% if page_obj.number == i %}
                            <li class="page-item active"><span class="page-link">{{ i }} <span class="sr-only">(current)</span></span></li>
                        {% else %}
                            <li class="page-item"><a class="page-link" href="?page={{ i }}">{{ i }}</a></li>
                        {% endif %}
                    {% endfor %}

                    {% if page_obj.has_next %}
                        <li class="page-item"><a class="page-link" href="?page={{ page_obj.next_page_number }}">Next &raquo;</a></li>
                    {% else %}
                        <li class="page-item disabled"><span class="page-link">Next &raquo;</span></li>
                    {% endif %}
                </ul>
            </nav>
        {% endif %}
    {% else %}
        <div class="no-vulnerabilities">
            <h3>You haven't reported any vulnerabilities yet.</h3>
            <p>When you report vulnerabilities, they will appear here.</p>
            <a href="{% url 'exploits:report_vulnerability' %}" class="btn btn-primary mt-3">Report a Vulnerability</a>
        </div>
    {% endif %}
</div>
{% endblock %}